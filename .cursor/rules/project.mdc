---
description: General project conventions and structure
alwaysApply: true
---

# Project Conventions

## Tech Stack

- **Runtime**: Bun
- **Framework**: React Router 7 with Cloudflare Workers
- **Styling**: vanilla-extract (type-safe CSS)
- **CMS**: Sanity (headless CMS with field-level localization)
- **Language**: TypeScript (strict mode)

## Localization

- Supports `es` (Spanish, default) and `en` (English)
- Field-level translations in Sanity using `localeString`, `localeText`, `localeBlockContent`, `localeSlug`
- Use `getLocalizedString()`, `getLocalizedSlug()`, `formatDate()` helpers from `~/lib/sanity`
- Routes are locale-prefixed: `/:locale/...` (e.g., `/es/blog`, `/en/contact`)

## Import Conventions

Use absolute imports with the `~` alias for app code:

```typescript
import { vars } from '~/styles'
import { client, getLocalizedString, type Post } from '~/lib/sanity'
```

## File Naming

- React components: PascalCase (e.g., `Header.tsx`)
- Style files: Same name with `.css.ts` extension (e.g., `Header.css.ts`)
- Utilities/hooks: camelCase (e.g., `locale.ts`, `sanity.ts`)
- Route files: lowercase with hyphens (e.g., `home.tsx`, `blog-post.tsx`)
- Sanity schema files: camelCase with `Type` suffix (e.g., `postType.ts`, `pageType.ts`)

## Component Structure

Colocate component files together:

```
app/
  components/
    Header/
      Header.tsx
      Header.css.ts
      index.ts
  lib/
    locale.ts    # Locale utilities
    sanity.ts    # Sanity client, types, and helpers
  routes/
    blog.tsx
    blog.css.ts
    blog-post.tsx
    blog-post.css.ts
```

## Sanity Content Types

- **Post**: Blog posts with localized title, slug, excerpt, body, image
- **Page**: Template pages (about, contact, legal) with localized title, slug, description, body

## Scripts

```bash
bun run dev        # Start development server
bun run build      # Production build
bun run typecheck  # Type checking
bun run deploy     # Deploy to Cloudflare
```

## Sanity Studio

Located in `/studio`, runs on `localhost:3333`:

```bash
cd studio && bun run dev
```

## Project Structure

```
/workspace
├── app/                    # Main application code
│   ├── components/         # Reusable UI components (PascalCase folders)
│   ├── lib/                # Utilities and helpers
│   │   ├── locale.ts       # Locale detection and validation
│   │   ├── sanity.ts       # Sanity client, queries, and types
│   │   └── posthog.ts      # Analytics
│   ├── routes/             # React Router routes (colocated with .css.ts)
│   ├── styles/             # Global styles and design tokens
│   └── routes.ts           # Route configuration
├── studio/                 # Sanity Studio (separate package)
│   └── schemaTypes/        # Content type definitions
├── workers/                # Cloudflare Workers entry
└── public/                 # Static assets
```

## Adding New Routes

1. Create route file in `app/routes/` (e.g., `links.tsx`)
2. Create colocated styles (e.g., `links.css.ts`)
3. Register route in `app/routes.ts`
4. Use `useOutletContext<LocaleContext>()` for locale access
5. Add translations object with all supported locales

## Supported Locales

- `es` - Spanish (default)
- `en` - English
- `de` - German
- `fr` - French
- `ja` - Japanese
